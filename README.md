# dynamic-pod-deployment-on-k8s

## Overview

- This document outlines an automated deployment process for Docker applications using Helm Chart on Kubernetes (K8s)
- Three major components of this workflow
    - Handler Function:
        - Takes user input `(input, appName, chartPath)` and uses `input` to generate a hash
        
        ```bash
        cmd: curl -X POST 'http://localhost:8081/generate?input=fuckyouniggers&appName=rg-beta-2&chartPath=/Users/raghavgade/neobase/deploy/helm/rg-beta-app'
        
        output: {"hash":"a3cc1f00a61488d55bb403645c1758da764290ffcb4616e52e79032137bcb63a"}
        ```
        
        - Stores hash key mapping locally while server is running (without a connected database)
        
        ```bash
        cmd: curl http://localhost:8081/hashes
        
        output:
        [
          {
            "input": "blahhhh",
            "appName": "rg-beta-1",
            "chartPath": "/Users/raghavgade/neobase/deploy/helm/rg-beta-app",
            "hash": "1f58449b17528331041895d4ed564b26fdbe3f5adf9c37c0aa95a2a1b9956306"
          },
          {
            "input": "fuckyouniggers",
            "appName": "rg-beta-2",
            "chartPath": "/Users/raghavgade/neobase/deploy/helm/rg-beta-app",
            "hash": "a3cc1f00a61488d55bb403645c1758da764290ffcb4616e52e79032137bcb63a"
          }
        ]
        ```
        
    - Containerised Go Application:
        - Runs on Kubernetes.
        - Returns hash key generated by the handler function.
        
        ```bash
        cmd: curl http://localhost:8080/hash
        output: 
        {
          "hash": "a3cc1f00a61488d55bb403645c1758da764290ffcb4616e52e79032137bcb63a"
        }
        ```
        
    - Helm Chart:
        - Manages Kubernetes deployment.
        - Utilises hash generated by the handler function, passed as an environment variable to the deployed container, automating Go application deployment.

## Handler Function

- Handler function manage the deployment process: generating hashes, storing them, and executing Helm commands for app deployment on Kubernetes.
    - **`generateHash(input string) string`**: Calculates SHA-256 hash from input and returns it.
    - **`generateHashHandler(c *gin.Context)`**: Handles hash generation requests, storing hashes and triggering app deployment.
    - **`getAllHashesHandler(c *gin.Context)`**: Manages requests to retrieve stored hashes, ensuring transparency.
    - **`runHelmInstall(appName, chartPath, hashValue string)`**: Executes Helm install command for app deployment on Kubernetes.

## Containerised Go Application

- **getHashHandler:** Retrieves hash value from environment variable **`HASH`**, encapsulates it into a JSON response for integration.
- **healthCheckHandler:** Monitors system health, providing reassurance with a concise operational status message.

## Helm Chart

- **Automated Deployment:** Orchestrates app deployment via handler function without manual intervention, reducing errors.
- **Dynamic Configuration:** Utilises generated hash for container environment setup, enhancing adaptability.

## Conclusion

- Efficiently automating Docker app deployment on Kubernetes via Helm Chart

**Scope for Improvements:**

- [ ] Implement a database for storing hashes to ensure consistency and durability.
- [ ] Enhance security measures to safeguard sensitive data and improve overall system integrity.